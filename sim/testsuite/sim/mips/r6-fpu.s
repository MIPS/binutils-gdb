# mips r6 fpu test for FMADD/FMSUB etc.
# TODO once as knows about r6, change mach here
# mach:  mips32r2 mips64r2
# as:    -mabi=eabi
# ld:    -N -Ttext=0x80010000
# output: *\\npass\\n

  .include "testutils.inc"
  .include "utils-r6.inc"

  setup

  .set noreorder

  .ent DIAG
DIAG:
  #TODO are these _really_ the correct FP answers?

  writemsg "[1] Test qNaN format is 754-2008"
  li $4, 0x0
  li $5, 0x0
  li $6, 0x7fc00000
  mtc1 $4, $f2
  mtc1 $5, $f4
  div.s $f6, $f2, $f4
  mfc1 $8, $f6
  fp_assert $6, $8

  writemsg "[2] Test fmadd.s"
  #fmadd.s f2,f4,f6 = f2 + f4*f6 = 0x44062098
  r6ck_fm_s 0x44062098, 0x0, 0x0, 0x0, 0x0
  r6ck_fm_s 0x44062098, 0x3f800000, 0x3f800000, 0x3f800000, 0x40000000
  r6ck_fm_s 0x44062098, 0xc0b1f5c3, 0x40490fd0, 0x402df854, 0x403e9f5d

  writemsg "[3] Test fmsub.s"
  #fmsub.s f2,f4,f6 = f2 - f4*f6 = 0x44062099
  r6ck_fm_s 0x44062099, 0x0, 0x0, 0x0, 0x0
  r6ck_fm_s 0x44062099, 0x3f800000, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x44062099, 0xc0b1f5c3, 0x40490fd0, 0x402df854, 0xc1619d9a

  writemsg "[4] Test fmadd.d"
  #fmadd.d f2,f4,f6 = f2 + f4*f6 = 0x44262098
  r6ck_fm_d 0x44262098, 0x0, 0x0, 0x0, 0x0
  r6ck_fm_d 0x44262098, 0x3ff0000000000000, 0x3ff0000000000000, 0x3ff0000000000000, 0x4000000000000000
  r6ck_fm_d 0x44262098, 0xc0163eb851eb851f, 0x400921f9f01b866e, 0x4005bf0a8b24919b,  0x4007d3ebc14f6cee

  writemsg "[5] Test fmsub.d"
  #fmsub.d f2,f4,f6 = f2 - f4*f6 = 0x44262099
  r6ck_fm_d 0x44262099, 0x0, 0x0, 0x0, 0x0
  r6ck_fm_d 0x44262099, 0x3ff0000000000000, 0x3ff0000000000000, 0x3ff0000000000000, 0x0
  r6ck_fm_d 0x44262099, 0xc0163eb851eb851f, 0x400921f9f01b866e, 0x4005bf0a8b24919b,  0xc02c33b3423f605b

  writemsg "[6] Test CMP.af.s"
  #cmp.af.s f2,f4,f6 = false ? f2 <- 2^n-1 : f2 <- 0 = 0x46862082
  r6ck_fm_s 0x46862082, 0x0, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x46862082, 0x0, 0x00000000, 0x3f800000, 0x0

  writemsg "[7] Test CMP.eq.s"
  #cmp.eq.s f2,f4,f6 = f4==f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x46862092
  r6ck_fm_s 0x46862092, 0x0, 0x3f800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x46862092, 0x0, 0x00000000, 0x3f800000, 0x0
  r6ck_fm_s 0x46862092, 0x0, 0x80000000, 0x00000000, 0xffffffff
  r6ck_fm_s 0x46862092, 0x0, 0x7fc00000, 0x7fc00000, 0x0
  r6ck_fm_s 0x46862092, 0x0, 0x7fc00000, 0xffc00000, 0x0
  r6ck_fm_s 0x46862092, 0x0, 0x7fa00000, 0x7fa00000, 0x0
  r6ck_fm_s 0x46862092, 0x0, 0x7fa00000, 0x7fc00000, 0x0
  r6ck_fm_s 0x46862092, 0x0, 0x7f800000, 0x7f800000, 0xffffffff
  r6ck_fm_s 0x46862092, 0x0, 0xff800000, 0xff800000, 0xffffffff

  writemsg "[8] Test CMP.ne.s"
  #cmp.neq.s f2,f4,f6 = f4!=f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x4686209c
  r6ck_fm_s 0x4686209c, 0x0, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x4686209c, 0x0, 0x00000000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x4686209c, 0x0, 0x80000000, 0x00000000, 0x0
  r6ck_fm_s 0x4686209c, 0x0, 0x7fc00000, 0x7fc00000, 0x0
  r6ck_fm_s 0x4686209c, 0x0, 0x7fc00000, 0xffc00000, 0x0
  r6ck_fm_s 0x4686209c, 0x0, 0x7fa00000, 0x7fa00000, 0x0
  r6ck_fm_s 0x4686209c, 0x0, 0x7fa00000, 0x7fc00000, 0x0
  r6ck_fm_s 0x4686209c, 0x0, 0x7f800000, 0x7f800000, 0x0
  r6ck_fm_s 0x4686209c, 0x0, 0xff800000, 0xff800000, 0x0

  writemsg "[9] Test CMP.lt.s"
  #cmp.lt.s f2,f4,f6 = f4<f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x468620a2
  r6ck_fm_s 0x468620a2, 0x0, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x468620a2, 0x0, 0x00000000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0xbf800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0x3f800000, 0xbf800000, 0x0
  r6ck_fm_s 0x468620a2, 0x0, 0xff800000, 0xbf800000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0xbf800000, 0x7f800000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0xbf800000, 0xff800000, 0x0
  r6ck_fm_s 0x468620a2, 0x0, 0x7f800000, 0xbf800000, 0x0

  writemsg "[10] Test CMP.le.s"
  #cmp.le.s f2,f4,f6 = f4<=f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x468620b2
  r6ck_fm_s 0x468620b2, 0x0, 0x3f800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620b2, 0x0, 0x00000000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620b2, 0x0, 0xbf800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620b2, 0x0, 0x3f800000, 0xbf800000, 0x0
  r6ck_fm_s 0x468620a2, 0x0, 0xff800000, 0xbf800000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0xbf800000, 0x7f800000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0xbf800000, 0xff800000, 0x0
  r6ck_fm_s 0x468620a2, 0x0, 0x7f800000, 0xbf800000, 0x0

  writemsg "[11] Test CMP.un.s"
  #cmp.un.s f2,f4,f6 = f4<>f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x4686208a
  r6ck_fm_s 0x4686208a, 0x0, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x4686208a, 0x0, 0x3f800000, 0xbf800000, 0x0
  r6ck_fm_s 0x4686208a, 0x0, 0x3f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x4686208a, 0x0, 0x7fc01234, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x4686208a, 0x0, 0x7fc00000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x4686208a, 0x0, 0x3f800000, 0xff800000, 0x0
  r6ck_fm_s 0x4686208a, 0x0, 0x3f800000, 0x7f800000, 0x0

  writemsg "[12] Test CMP.or.s"
  #cmp.or.s f2,f4,f6 = f4<=f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x4686208c
  r6ck_fm_s 0x4686208c, 0x0, 0x3f800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x4686208c, 0x0, 0xbf800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x4686208c, 0x0, 0x3f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x4686208c, 0x0, 0x7fc00000, 0x3f800000, 0x0
  r6ck_fm_s 0x4686208c, 0x0, 0xffc00000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x4686208c, 0x0, 0x7fc01234, 0x7fc00000, 0x0
  r6ck_fm_s 0x468620a2, 0x0, 0xff800000, 0x00000000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0x00000000, 0x7f800000, 0xffffffff
  r6ck_fm_s 0x468620a2, 0x0, 0x00000000, 0xff800000, 0x0
  r6ck_fm_s 0x468620a2, 0x0, 0x7f800000, 0x00000000, 0x0

  writemsg "[13] Test CMP.ueq.s"
  #cmp.ueq.s f2,f4,f6 = f4 ueq f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x4686209a
  r6ck_fm_s 0x4686209a, 0x0, 0x3f800000, 0x00000000, 0x0
  r6ck_fm_s 0x4686209a, 0x0, 0x3f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x4686209a, 0x0, 0x7fc00000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x4686209a, 0x0, 0x3f800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x4686209a, 0x0, 0x00000000, 0x3f800000, 0x0
  r6ck_fm_s 0x4686209a, 0x0, 0x80000000, 0x00000000, 0xffffffff
  r6ck_fm_s 0x4686209a, 0x0, 0x7f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x4686209a, 0x0, 0xff800000, 0xff800000, 0xffffffff

  writemsg "[14] Test CMP.une.s"
  #cmp.une.s f2,f4,f6 = f4 une f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x46862094
  r6ck_fm_s 0x46862094, 0x0, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x46862094, 0x0, 0x3f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x46862094, 0x0, 0x7fc00000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x46862094, 0x0, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x46862094, 0x0, 0x00000000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x46862094, 0x0, 0x80000000, 0x00000000, 0x0
  r6ck_fm_s 0x46862094, 0x0, 0x7f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x46862094, 0x0, 0xff800000, 0xff800000, 0x0

  writemsg "[15] Test CMP.ult.s"
  #cmp.ult.s f2,f4,f6 = f4 ult f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x468620aa
  r6ck_fm_s 0x468620aa, 0x0, 0x3f800000, 0x3f800000, 0x0
  r6ck_fm_s 0x468620aa, 0x0, 0x3f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x468620aa, 0x0, 0x7fc00000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x468620aa, 0x0, 0x00000000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620aa, 0x0, 0xbf800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620aa, 0x0, 0x3f800000, 0xbf800000, 0x0

  writemsg "[16] Test CMP.ule.s"
  #cmp.ule.s f2,f4,f6 = f4 ule f6 ? f2 <- 2^n-1 : f2 <- 0 = 0x468620ba
  r6ck_fm_s 0x468620ba, 0x0, 0x3f800000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x468620ba, 0x0, 0x7fc00000, 0x7fc00000, 0xffffffff
  r6ck_fm_s 0x468620ba, 0x0, 0x3f800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620ba, 0x0, 0x00000000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620ba, 0x0, 0xbf800000, 0x3f800000, 0xffffffff
  r6ck_fm_s 0x468620ba, 0x0, 0x3f800000, 0xbf800000, 0x0
  r6ck_fm_s 0x468620ba, 0x0, 0x3f800000, 0xff800000, 0x0

  pass

  .end DIAG
